apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: ksecwatch
  namespace: monitoring
  labels:
    release: kps
spec:
  route:
    receiver: slack-ksecwatch
    groupBy:
      - alertname
    groupWait: 10s
    groupInterval: 30s
    repeatInterval: 1m

  receivers:
    - name: slack-ksecwatch
      slackConfigs:
        - apiURL:
            name: slack-webhook
            key: url
          channel: "#ksecwatch-alerts"
          sendResolved: true
          username: "KSECWATCH Bot"
          title: >-
            {{ if eq .Status "firing" }}
              ğŸš¨ [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}
            {{ else }}
              ğŸŸ¢ [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}
            {{ end }}
          text: >-
            {{ if eq .Status "firing" }}
              ğŸ”¥ *Severity:* {{ .CommonLabels.severity }}
              ğŸ§© *Project:* {{ .CommonLabels.project }}
              ğŸ“‚ *Category:* {{ .CommonLabels.category }}
              ğŸ“ *Description:* {{ .CommonAnnotations.description }}
            {{ else }}
              ğŸ‘Œ Issue has been resolved.
            {{ end }}
